# MyAniBook API

REST API для социальной платформы, связанной с аниме. Позволяет регистрировать пользователей, управлять профилями, аниме-листами и постами.

## Стек технологий

- **NestJS** — фреймворк
- **PostgreSQL** — база данных
- **Sequelize** — ORM
- **JWT** — аутентификация
- **Swagger** — документация API
- **Docker** — контейнеризация

## Установка и запуск

### Локально

```bash
# Установить зависимости
npm install

# Запустить в режиме разработки
npm run start:dev

# Собрать и запустить продакшн
npm run build
npm run start:prod
```

### Через Docker

```bash
docker-compose up --build
```

## Переменные окружения

Создай файл `.env` в корне проекта (пример в `.env.example`):

```env
PORT=5000

DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=myanibook

PRIVATE_KEY=your_secret_key
```

## Документация API

После запуска Swagger доступен по адресу:

```
http://localhost:5000/api/docs
```

## Аутентификация

Защищённые эндпоинты требуют заголовок:

```
Authorization: Bearer <token>
```

Токен выдаётся при регистрации или входе и действителен **24 часа**.

## Статические файлы

Аватары и изображения постов доступны напрямую по URL:

```
http://localhost:5000/<filename>
```

## Эндпоинты

> Колонка **Доступ**: **JWT** — требуется авторизация (Bearer-токен), **ADMIN** — расширенный доступ, **—** — публичный эндпоинт.

### Авторизация `/auth`

| Метод | Путь | Доступ | Описание |
|-------|------|--------|----------|
| POST | `/auth/registration` | — | Регистрация нового пользователя |
| POST | `/auth/login` | — | Вход, возвращает JWT-токен |

### Пользователи `/users`

| Метод | Путь | Доступ | Описание |
|-------|------|--------|----------|
| GET | `/users` | ADMIN | Получить всех пользователей |
| POST | `/users/role` | ADMIN | Назначить роль пользователю |
| POST | `/users/ban` | ADMIN | Забанить пользователя |

### Профиль `/users-info`

| Метод | Путь | Доступ | Описание |
|-------|------|--------|----------|
| GET | `/users-info/:id` | — | Получить профиль по ID пользователя |
| GET | `/users-info` | ADMIN | Получить все профили |
| POST | `/users-info/nickname` | JWT | Сменить никнейм |
| POST | `/users-info/avatar` | JWT | Сменить аватар (макс. 500KB) |
| POST | `/users-info/anime-list` | JWT | Обновить аниме-лист |
| POST | `/users-info/anime-day-of-addition-list` | JWT | Обновить список дат добавления аниме |

### Роли `/roles`

| Метод | Путь | Доступ | Описание |
|-------|------|--------|----------|
| POST | `/roles` | ADMIN | Создать роль |
| GET | `/roles/:value` | — | Получить роль по значению |

### Посты `/posts`

| Метод | Путь | Доступ | Описание |
|-------|------|--------|----------|
| POST | `/posts` | JWT | Создать пост (с изображением, макс. 1MB) |
